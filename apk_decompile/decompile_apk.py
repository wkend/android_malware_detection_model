#!/usr/bin/env python 3.7
# -*- coding: utf-8 -*-
# @Time    : 2019/5/8 14:06
# @Author  : wkend
# @File    : decompile_apk.py
# @Software: PyCharm

import os


def apk_decompile(input_apk_path, output_apk_path):
    """
    批量反汇编apk文件
    :param input_apk_path:
    :param output_apk_path:
    :return:
    """
    if not os.path.isdir(input_apk_path) or os.path.isfile(input_apk_path):
        return False
    sub_dir_list = os.listdir(input_apk_path)  # 获取子文件夹名
    for i in range(len(sub_dir_list)):
        sub_dir_path = input_apk_path + '/' + sub_dir_list[i]
        apk_list = os.listdir(sub_dir_path)
        for j in range(len(apk_list)):
            output_path = output_apk_path
            apk_path = sub_dir_path + '/' + apk_list[j]
            part = os.path.splitext(apk_list[j])
            output_path = output_path + '/' + sub_dir_list[i] + '/' + part[0]

            cmd = "apktool d {0} -o {1}".format(apk_path, output_path)
            os.system(cmd)


if __name__ == '__main__':
    malware_apk_path = 'E:/毕设/软件样本库/恶意软件/samples'
    benign_apk_path = 'E:/毕设/软件样本库/良性软件/samples'

    malware_output_apk_path = 'E:/毕设/软件样本库/恶意软件/decompile'
    benign_output_apk_path = 'E:/毕设/软件样本库/良性软件/decompile'

    # apk_decompile(malware_apk_path,malware_output_apk_path)
    apk_decompile(benign_apk_path, benign_output_apk_path)

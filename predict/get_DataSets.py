#!/usr/bin/env python 3.7
# -*- coding: utf-8 -*-
# @Time    : 2019/5/8 14:15
# @Author  : wkend
# @File    : get_DataSets.py
# @Software: PyCharm


import os
from predict.parse_AndroidManifest import get_elementTree, get_actList, get_serList, get_receList, get_provList, \
    get_permission



def get_dataSets(path):
    """提取样本文件中的权限、组件信,构造得到数据集"""
    X = []
    sub_path = os.listdir(path)
    for i in range(len(sub_path)):
        path_1 = os.path.join(path, sub_path[i])
        # print('path_1: '+path_1)
        dir_1 = os.listdir(path_1)
        for j in range(len(dir_1)):
            # print(dir_1[j])
            dir_2 = os.path.join(path_1, dir_1[j])
            # print('dir_2: '+dir_2)
            if 'AndroidManifest.xml' in os.listdir(dir_2):
                # print('AndroidManifest')
                # print(os.listdir(dir_2))
                xml_file_index = os.listdir(dir_2).index('AndroidManifest.xml')
                # print(xml_file_index)
                xml_file_path = os.path.join(dir_2, os.listdir(dir_2)[xml_file_index])
                # print(xml_file_path)
                components_counts = []
                doc = get_elementTree(xml_file_path)

                components_counts.append(get_actList(doc))
                components_counts.append(get_serList(doc))
                components_counts.append(get_receList(doc))
                components_counts.append(get_provList(doc))

                permission_list, X_permission = get_permission(doc)

                data_sets = X_permission
                data_sets.extend(components_counts)
                # print(data_sets)
                X.append(data_sets)
    return X
